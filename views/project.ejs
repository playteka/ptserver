<! DOCTYPE html>
<html lang="<%=lang.language%>">

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="project list of playteka products">
<meta name="author" content="Zhou Keke">

<title>Playteka - Project Center</title>

<!-- Bootstrap Core CSS -->
<link href="css/bootstrap.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="css/landing-page.css" rel="stylesheet">

<!-- Custom Fonts -->
<!-- link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" -->
<!-- link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css" -->

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<!-- jQuery -->
<script src="js/jquery.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="js/bootstrap.min.js"></script>

<script type="text/javascript">

var changeLanguage = function(language){
if (language == 'English') {
window.location.assign('/project?lang=en');
}
else{
window.location.assign('/project?lang=cn');
}
};

var logout = function(){
var posting = $.post("/logout");
posting.done(function(){
window.location.assign('/login?lang=<%=lang.language%>');
});
};

var userProfile = function(){
window.location.assign('/subscriber?lang=<%=lang.language%>');
};

var configProject = function(program, _id){
window.location.assign('/' + program + 'config/?_id=' + _id + '&lang=<%=lang.language%>');
};

var openProject = function(program, _id){
window.location.assign('/blockly/app/' + program + '/?_id=' + _id + '&lang=<%=lang.language%>');
};

isNotSafe = function(str) {
var filterString = "";
filterString = filterString == "" ? "'~`·!?@#$%^&*()-+./\" " : filterString
var ch;
var i;
var temp;
var error = false; // 当包含非法字符时，返回True
if(str.length==0){
error = true;
return error;
}
for (i = 0; i <= (filterString.length - 1); i++) {
ch = filterString.charAt(i);
temp = str.indexOf(ch);
if (temp != -1) {
error = true;
break;
}
}
return error;
}

String.prototype.trim = function(){
//去掉两边的空格
return this.replace(/(^\s*)|(\s*$)/g,'');
}

//字符串首尾加单引号
var QM = function(s){
return "'" + s + "'";
};

//字符串首尾加双引号
var DQM = function(s){
return '"' + s + '"';
};

var show_alert_box = function(program,text){
value = '<span class="glyphicon glyphicon-exclamation-sign"></span> ' + text;
$("#"+program+"_alert_box").html(value);
$("#"+program+"_alert_box").show();
};


var deleteProject = function(program, _id){

if (confirm("<%=lang.delete_project%>")==false) return;

var posting = $.post("/project/deleteplayduino", {"_id" : _id});
posting.done(function(result){
if (result.status == "error") {
alert("This project couldn't be delelted!");
}
else{
$("#"+program+_id).fadeOut("slow");
$("#"+program+_id).remove();
}
}).
fail(function(){
//alert("network failed!");
});
};



var add_line = function(program, project){
var _id = project._id;
var ipaddress = project.ipaddress;
var published = (project.published=='1' ? "<%=lang.Public%>" : "<%=lang.Private%>");
var text = '<tr id=' + DQM(program + _id) + '>';
text += '<td><a onclick="openProject('+ QM(program) + ',' + QM(_id) +')"><h4 class="list-group-item-heading">' + project.project_name + '</h4></a></td>';
text += '<td align="right"><h4 class="list-group-item-heading">' + ipaddress + '</h4></td>';
text += '<td align="right"><h4 class="list-group-item-heading">' + published + '</h4></td>';
text += '<td align="right"><span class="glyphicon glyphicon-th-list" onclick="configProject('+ QM(program) + ',' + QM(_id) +')"></span></td>';
text += '</tr>';

$("#"+program+"_table").prepend(text);
};

var add_playduino_project = function(){
var project_name = $("#playduino_project_name").val();
project_name = project_name.trim();
if(isNotSafe(project_name)) {
show_alert_box('playduino', "project name consists of only alphabets and numbers!");
return;
}

var posting = $.post("/project/playduino", {"project_name" : project_name});

posting.done(function(result){
//alert("数据：" + JSON.stringify(result.body) + "\n状态：" + result.status + result.errorno);

if (result.status == "error") {
if (result.errorno == 1) {  //not yet logined.
window.location.assign('/login');
}
else if (result.errorno == 4) { //project name already exists.
show_alert_box("playduino", "Project name already exists");
return;
};
}
else{ //result.status == "success"
var project = result.body;
add_line("playduino",project);
$("#playduino_project_name").val("");
}
}).
fail(function(){
//alert("network failed!");
});
}

var add_playpi_project = function(){
var project_name = $("#playpi_project_name").val();
project_name = project_name.trim();
if(isNotSafe(project_name)) {
$("#playpi_alert_box").show();
}
else{
add_line("playpi",project_name);
$("#playpi_project_name").val("");
}
};

var add_playdrawing_project = function(){
var project_name = $("#playdrawing_project_name").val();
project_name = project_name.trim();
if(isNotSafe(project_name)) {
$("#playdrawing_alert_box").show();
}
else{
add_line("playdrawing",project_name);
$("#playdrawing_project_name").val("");
}
};

function get_heartbeat(){
var getting = $.get('/heartbeat');
getting.done(function(result){
console.log(result);
})
.fail(function(){
console.log("heartbeat network error");
});
}

$(document).ready(function(){

$("#playduino_alert_box").hide();
$("#playpi_alert_box").hide();
$("#playdrawing_alert_box").hide();

var getting = $.get("/project/playduino");
getting.done(function(result){
if (result.status == 'error') {
window.location.assign('/login');
}
else{
var project_list = result.body;
for(var i in project_list){
//alert(JSON.stringify(project_list[i]));
add_line('playduino',project_list[i]);
}
}
}).
fail(function(){
//alert("network failed!");
});



$("#playduino_project_name").keyup(function(event){
$("#playduino_alert_box").hide();
if(event.which == 13){
$("#playduino_addproject_button").click();
}
});

$("#playpi_project_name").keyup(function(event){
$("#playpi_alert_box").hide();
if(event.which == 13){
$("#playpi_addproject_button").click();
}
});

$("#playdrawing_project_name").keyup(function(event){
$("#playdrawing_alert_box").hide();
if(event.which == 13){
$("#playdrawing_addproject_button").click();
}
});

setInterval("get_heartbeat()", 30*1000);

});

</script>


</head>


<body>

<!-- Navigation -->
<nav class="navbar navbar-default navbar-fixed-top topnav" role="navigation">
<div class="container topnav">
<!-- Brand and toggle get grouped for better mobile display -->
<div class="navbar-header">
<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="http://www.playteka.com">Playteka</a>
</div>
<div id="navbar" class="navbar-collapse collapse">
<ul class="nav navbar-nav">
<li class="active"><a href="http://localhost:3000"><%=lang.Home%></a></li>
<li><a href="http://www.playteka.com"><%=lang.Website%></a></li>
<li><a href="https://github.com/playteka/playteka/wiki"><%=lang.Wiki%></a></li>
<li><a href="https://github.com/playteka/playteka/issues"><%=lang.Report_Issues%></a></li>
<li><a href="http://www.playteka.com"><%=lang.Contact%></a></li>
<li><a href="#" onclick="alert('playteka v0.1.5')" ><%=lang.About%></a></li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><%=account%><span class="caret"></span></a>
<ul class="dropdown-menu" role="menu">
<li><a href='#' onclick="userProfile()"><%=lang.User_Profile%></a></li>
<li><a href='#' onclick="logout()"><%=lang.Logout%></a></li>
</ul>
</li>

<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
<%=lang.current_language%><span class="caret"></span></a>
<ul class="dropdown-menu" role="menu">
<% for(var i=0; i<lang.other_languages.length; i++) { %>
<li>
<a href='#' onclick="changeLanguage('<%= lang.other_languages[i]%>')"><%=lang.other_languages[i] %></a>
</li>
<% } %>
</ul>
</li>
</ul>
</div><!--/.nav-collapse -->
</div>
<!-- /.container -->
</nav>


<!-- Header -->
<a name="home"></a>
<div class="intro-header">
<div class="container">
<div class="row">
<div class="col-lg-12">
<div class="intro-message">
<h1><img src="./img/playteka.png"></h1>
<h1><%=lang.Project_Center%></h1>
<hr class="intro-divider">
<h2>Hola! <%=account%>, <%=lang.are_you_ready%></h2>
<ul class="list-inline">
<li><a href="#playduino"><button type="button" class="btn btn-default btn-lg">
<span class="glyphicon glyphicon-hand-right"><span> <%=lang.PlayDuino%></button></a></li>
<li><a href="#playpi"><button type="button" class="btn btn-default btn-lg">
<span class="glyphicon glyphicon-hand-right"><span> <%=lang.PlayPi%></button></a></li>
<li><a href="#playdrawing"><button type="button" class="btn btn-default btn-lg">
<span class="glyphicon glyphicon-hand-right"><span> <%=lang.PlayDrawing%></button></a></li>
</ul>
</div>
</div>
</div>

</div>
<!-- /.container -->

</div>
<!-- /.intro-header -->

<!-- Page Content -->

<a  name="playduino"></a>
<div class="content-section-a">

<div class="container">
<div class="row">
<div class="col-lg-5 col-sm-6">
<hr class="section-heading-spacer">
<div class="clearfix"></div>
<h2 class="section-heading"><a href="#home"><span class="glyphicon glyphicon-hand-up"></span></a>     <%=lang.PlayDuino%></h2>
<div class="input-group">
<input type="text" class="form-control" placeholder="<%=lang.Project_Name%>" id="playduino_project_name">
<span class="input-group-btn">
<button class="btn btn-default" type="button" id="playduino_addproject_button" onclick="add_playduino_project()">
<span class="glyphicon glyphicon-plus"></span></button>
</span>
</div><!-- /input-group -->
<br>
<div class="alert alert-danger" role="alert" id="playduino_alert_box">
<span class="glyphicon glyphicon-exclamation-sign"></span> Special charaters like space, ~·!?@#$%*()-+, etc must be removed.</div>
<table class="table table-striped table-hover" id="playduino_table">
</table>
</div>
<div class="col-lg-5 col-lg-offset-2 col-sm-6">
<img class="img-responsive" src="img/ipad.png" alt="">
</div>
</div>

</div>
<!-- /.container -->

</div>
<!-- /.content-section-a -->
<a  name="playpi"></a>
<div class="content-section-b">
<div class="container">
<div class="row">
<div class="col-lg-5 col-lg-offset-1 col-sm-push-6  col-sm-6">
<hr class="section-heading-spacer">
<div class="clearfix"></div>
<h2 class="section-heading"><a href="#home"><span class="glyphicon glyphicon-hand-up"></span></a>     <%=lang.PlayPi%></h2>
<div class="input-group">
<input type="text" class="form-control" placeholder="<%=lang.Project_Name%>" id="playpi_project_name">
<span class="input-group-btn">
<button class="btn btn-default" type="button" id="playpi_addproject_button" onclick="add_playpi_project()">
<span class="glyphicon glyphicon-plus"></span></button>
</span>
</div><!-- /input-group -->
<br>
<div class="alert alert-danger" role="alert" id="playpi_alert_box">
<span class="glyphicon glyphicon-exclamation-sign"></span> Special charaters like space, ~·!@#$%*()-+, etc must be removed.</div>
<table class="table table-striped table-hover" id="playpi_table">
</table>
</div>
<div class="col-lg-5 col-sm-pull-6  col-sm-6">
<img class="img-responsive" src="img/dog.png" alt="">
</div>
</div>

</div>
<!-- /.container -->

</div>
<!-- /.content-section-b -->
<a  name="playdrawing"></a>
<div class="content-section-a">
<div class="container">
<div class="row">
<div class="col-lg-5 col-sm-6">
<hr class="section-heading-spacer">
<div class="clearfix"></div>
<h2 class="section-heading"><a href="#home"><span class="glyphicon glyphicon-hand-up"></span></a>     <%=lang.PlayDrawing%></h2>
<div class="input-group">
<input type="text" class="form-control" placeholder="<%=lang.Project_Name%>" id="playdrawing_project_name">
<span class="input-group-btn">
<button class="btn btn-default" type="button" id="playdrawing_addproject_button" onclick="add_playdrawing_project()">
<span class="glyphicon glyphicon-plus"></span></button>
</span>
</div><!-- /input-group -->
<br>
<div class="alert alert-danger" role="alert" id="playdrawing_alert_box">
<span class="glyphicon glyphicon-exclamation-sign"></span> Special charaters like space, ~·!@#$%*()-+, etc must be removed.</div>
<table class="table table-striped table-hover" id="playdrawing_table">
</table>
</div>
<div class="col-lg-5 col-lg-offset-2 col-sm-6">
<img class="img-responsive" src="img/phones.png" alt="">
</div>
</div>

</div>
<!-- /.container -->

</div>
<!-- /.content-section-a -->

<a  name="contact"></a>
<div class="banner">

<div class="container">

<div class="row">
<div class="col-lg-6">
<h2><%=lang.Connect_to_Playteka%></h2>
</div>
<div class="col-lg-6">
<ul class="list-inline banner-social-buttons">
<li>
<a href="https://twitter.com/SBootstrap" class="btn btn-default btn-lg"><i class="fa fa-twitter fa-fw"></i> <span class="network-name">Twitter</span></a>
</li>
<li>
<a href="https://github.com/IronSummitMedia/startbootstrap" class="btn btn-default btn-lg"><i class="fa fa-github fa-fw"></i> <span class="network-name">Github</span></a>
</li>
<li>
<a href="#" class="btn btn-default btn-lg"><i class="fa fa-linkedin fa-fw"></i> <span class="network-name">Linkedin</span></a>
</li>
</ul>
</div>
</div>

</div>
<!-- /.container -->

</div>
<!-- /.banner -->

<!-- Footer -->
<footer>
<div class="container">
<div class="row">
<div class="col-lg-12">
<p class="copyright text-muted small">Copyright &copy; Playteka 2015. All Rights Reserved</p>
</div>
</div>
</div>
</footer>



</body>

</html>